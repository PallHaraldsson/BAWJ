<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>3 - The design set-up · BAWJ</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="BAWJ logo"/></a><div class="docs-package-name"><span class="docs-autofit">BAWJ</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Business Applications with Julia</a></li><li><span class="tocitem">Section 1</span><ul><li><a class="tocitem" href="../chapter1/">1 - Intro Notebook</a></li><li><a class="tocitem" href="../chapter2/">2 - Overview Julia</a></li></ul></li><li><span class="tocitem">Section 2 - Building the application</span><ul><li class="is-active"><a class="tocitem" href>3 - The design set-up</a><ul class="internal"><li><a class="tocitem" href="#Terms-and-definitions-1"><span>Terms and definitions</span></a></li><li><a class="tocitem" href="#A-procedure-as-a-starting-point-1"><span>A procedure as a starting point</span></a></li><li><a class="tocitem" href="#A-review-of-the-procedure-Invoicing-1"><span>A review of the procedure Invoicing</span></a></li><li><a class="tocitem" href="#The-design-1"><span>The design</span></a></li><li><a class="tocitem" href="#Application-infrastructure-1"><span>Application infrastructure</span></a></li><li><a class="tocitem" href="#ToDo-1"><span>ToDo</span></a></li></ul></li><li><a class="tocitem" href="../chapter4/">4 - Implementing the design</a></li><li><a class="tocitem" href="../chapter5/">5 - Writing test software</a></li></ul></li><li><span class="tocitem">Section 3 - Modules</span><ul><li><a class="tocitem" href="../chapter6/">6 - Creating modules</a></li><li><a class="tocitem" href="../chapter7/">7 - Documenting the modules</a></li></ul></li><li><span class="tocitem">Section 4 - SSH enabled containers</span><ul><li><a class="tocitem" href="../chapter8/">8 - Introduction</a></li><li><a class="tocitem" href="../chapter9/">9 - Create SSH enabled Containers</a></li><li><a class="tocitem" href="../chapter10/">10 - Raspberry Pi</a></li></ul></li><li><span class="tocitem">Section 5 Up and running</span><ul><li><a class="tocitem" href="../chapter11/">11 - Running functions remote</a></li><li><a class="tocitem" href="../chapter12/">12 - Running the containers</a></li><li><a class="tocitem" href="../chapter13/">13 - Logging</a></li><li><a class="tocitem" href="../chapter20/">20 - Using Remote Channels (old stuff)</a></li></ul></li><li><a class="tocitem" href="../appendix/">Appendix</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Section 2 - Building the application</a></li><li class="is-active"><a href>3 - The design set-up</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>3 - The design set-up</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/rbontekoe/BAWJ/blob/master/docs/src/chapter3.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-design-set-up-1"><a class="docs-heading-anchor" href="#The-design-set-up-1">3 - The design set-up</a><a class="docs-heading-anchor-permalink" href="#The-design-set-up-1" title="Permalink"></a></h1><h3 id="What-you-will-learn-1"><a class="docs-heading-anchor" href="#What-you-will-learn-1">What you will learn</a><a class="docs-heading-anchor-permalink" href="#What-you-will-learn-1" title="Permalink"></a></h3><ul><li><a href="#The-design-set-up-1">3 - The design set-up</a></li><ul><li><a href="#Terms-and-definitions-1">Terms and definitions</a></li><li><a href="#A-procedure-as-a-starting-point-1">A procedure as a starting point</a></li><li><a href="#A-review-of-the-procedure-Invoicing-1">A review of the procedure Invoicing</a></li><li><a href="#The-design-1">The design</a></li><li><a href="#Application-infrastructure-1">Application infrastructure</a></li><li><a href="#ToDo-1">ToDo</a></li></ul></ul><p>First, let&#39;s look at some terms and definitions. We&#39;ll convert the procedure <code>Invoicing</code> to a controlled-process model using the Onion Architecture pattern. <code>Domain</code> elements, like an invoice or journal record, define the starting point. Procedure <code>actions</code> become Julia-functions in the <code>API</code> I peel and use Domain elements. The <code>Infrastructure</code> layer interacts with the outer world and the inner layers.</p><p>Chapter 4, Implementing the design, realizes the design. Making a Julia module of our model offers the ease of downloading it as a package and use it in our programs.</p><hr/><h2 id="Terms-and-definitions-1"><a class="docs-heading-anchor" href="#Terms-and-definitions-1">Terms and definitions</a><a class="docs-heading-anchor-permalink" href="#Terms-and-definitions-1" title="Permalink"></a></h2><p>The points of attention are:</p><ul><li>Procedure,</li><li>Controlled-process,</li><li>Automatic-process,</li><li>Transaction data,</li><li>Domain-driven design,</li><li>Distributed processing, and</li><li>Style conventions.</li></ul><h3 id="Procedure-1"><a class="docs-heading-anchor" href="#Procedure-1">Procedure</a><a class="docs-heading-anchor-permalink" href="#Procedure-1" title="Permalink"></a></h3><p>A procedure is a description of work practice. It describes a series of actions in a particular order and interacts with people and machines. Actions make use of resources. Data, a service or a product, is the output of work.</p><p>A process is the realization of the procedure. There are controlled and automatic processes.</p><h3 id="Controlled-process-1"><a class="docs-heading-anchor" href="#Controlled-process-1">Controlled-process</a><a class="docs-heading-anchor-permalink" href="#Controlled-process-1" title="Permalink"></a></h3><p>An input activates a controlled process.</p><p>In the course, we look at a procedure <code>invoicing,</code> which is activated when it receives a list of attendees of a training course. It produces invoices and sends them to the organization that has registered the student. The application sends journal records will to the general ledger application.</p><h3 id="Automatic-process-1"><a class="docs-heading-anchor" href="#Automatic-process-1">Automatic-process</a><a class="docs-heading-anchor-permalink" href="#Automatic-process-1" title="Permalink"></a></h3><p>An automatic process has a heartbeat that runs the process by itself and produces a continuous output.</p><p>In the course, we look at a process that takes pictures every five seconds of the hallway. When there is a noticeable difference with the previous image, it sends it to another application for further analysis.</p><h3 id="Transaction-data-1"><a class="docs-heading-anchor" href="#Transaction-data-1">Transaction data</a><a class="docs-heading-anchor-permalink" href="#Transaction-data-1" title="Permalink"></a></h3><p>Both processes generate a lot of data and store it in a file or database. They are the owner of that data. The data can be analyzed to make a prediction. Nowadays, machine learning, in particular, deep learning techniques, are used for these tasks.</p><p>In the case of the invoicing process, we could look at the trend of payment morale. In the case of the picture-taking process, we could determine whether the room is empty or not.</p><h3 id="Domain-driven-design-1"><a class="docs-heading-anchor" href="#Domain-driven-design-1">Domain-driven design</a><a class="docs-heading-anchor-permalink" href="#Domain-driven-design-1" title="Permalink"></a></h3><p>Each process should be domain-specific. Subject matter experts and users of the domain speak the same language and use the same definitions and synonyms for concepts and objects. It leads to a Domain-driven design paradigm.</p><p>The Onion Architecture lends itself perfectly to the domain-driven design pattern. It divides domain-specific matters into four areas: core, domain, API, and infrastructure.</p><p>The core is the Julia language and libraries.</p><p>The next peel, the domain, defines and materializes domain objects and concepts.  Between its elements, there must be coherence. You only use constructs from the <code>core.</code> An invoice or an empty-room are examples.</p><p>The next layer is the API. The API consists of Julia functions that operate on the domain elements, and are used to create programs. You only use constructs from the <code>core and the domain.</code></p><p><code>process_list_of_attendees,</code> <code>create_invoice,</code> <code>create_pdf,</code> <code>create_empty_room</code> are examples.</p><p>The infrastructure layer is the ultimate peel. With its functions, it communicates with the external world. Adapters overcome mismatches between interfaces. When you write you the code, you use <code>elements from the inner layers.</code></p><p><code>create_list_of_attendees</code> is an example function that processes a REST POST-command.</p><h3 id="Distributed-proc3essing-1"><a class="docs-heading-anchor" href="#Distributed-proc3essing-1">Distributed proc3essing</a><a class="docs-heading-anchor-permalink" href="#Distributed-proc3essing-1" title="Permalink"></a></h3><p>Programs, written in Julia language, can run on other processor cores. Even in Docker containers on remote machines. Julia uses the master-worker concept. It means you execute Julia&#39;s functions on workers.</p><p>Julia&#39;s <code>remotecall_fetch</code> function runs functions (our actions!) remotely. Internet of Things (IoT) applications are automatic-processes. To give commands and receive data, we use of Julia channels.</p><h3 id="Style-conventions-1"><a class="docs-heading-anchor" href="#Style-conventions-1">Style conventions</a><a class="docs-heading-anchor-permalink" href="#Style-conventions-1" title="Permalink"></a></h3><p>The article <a href="https://github.com/invenia/BlueStyle">Blue: a Style Guide for Julia</a> describes the style conventions.</p><hr/><h2 id="A-procedure-as-a-starting-point-1"><a class="docs-heading-anchor" href="#A-procedure-as-a-starting-point-1">A procedure as a starting point</a><a class="docs-heading-anchor-permalink" href="#A-procedure-as-a-starting-point-1" title="Permalink"></a></h2><p>In 1994 we were delivering Lotus Notes instructor-led training in the Netherlands. We became ISO-9001 certified one year later. ISO is short for the International Organization for Standardization. A part of ISO is the section procedures.</p><p>A procedure describes a workflow. It specifies the activities to be carried out by people or machines and the resources that are required to produce a result.</p><p>An input triggers a process. Every action creates an output, which can be data, a product, or a service.</p><p>The example I use in the course is the procedure <code>Invoicing.</code></p><h3 id="The-course-example-1"><a class="docs-heading-anchor" href="#The-course-example-1">The course example</a><a class="docs-heading-anchor-permalink" href="#The-course-example-1" title="Permalink"></a></h3><p>In 1998 we rewrote our procedures as a table. Every row represents an action. Next to the activities are the columns with the roles involved with the work. We used the RASCI notation for the kind of task of a role:</p><table><tr><th style="text-align: left">Abbr</th><th style="text-align: left">Meaning</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left">R</td><td style="text-align: left">Responsible</td><td style="text-align: left">The person who is responsible for the execution of the activity.</td></tr><tr><td style="text-align: left">A</td><td style="text-align: left">Approves</td><td style="text-align: left">The person who approves the result before going to the next step.</td></tr><tr><td style="text-align: left">S</td><td style="text-align: left">Supports</td><td style="text-align: left">The members of the team.</td></tr><tr><td style="text-align: left">C</td><td style="text-align: left">Consults</td><td style="text-align: left">The person or entity to be consulted.</td></tr><tr><td style="text-align: left">I</td><td style="text-align: left">Informed</td><td style="text-align: left">The person to be notified about the result.</td></tr></table><hr/><p><strong>Roles</strong>: OM = Office Manage, AOM = Assistant Office Manager.</p><p><strong>Input</strong>: A list of students who have shown up in the classroom.</p><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">AOM</th><th style="text-align: left">OM</th><th style="text-align: left">Output</th><th style="text-align: left">Tool</th><th style="text-align: left">Exception</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">Create an invoice per student</td><td style="text-align: left">R</td><td style="text-align: left">A</td><td style="text-align: left">Created and authorized invoices</td><td style="text-align: left">Order file</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">Archive a copy of the invoice</td><td style="text-align: left">R</td><td style="text-align: left"></td><td style="text-align: left">Archived copy</td><td style="text-align: left">Accounts Receivable unpaid</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">Send the invoice to the customer</td><td style="text-align: left">R</td><td style="text-align: left">I</td><td style="text-align: left">Invoice sent</td><td style="text-align: left"></td><td style="text-align: left"></td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">Book the invoice</td><td style="text-align: left">R</td><td style="text-align: left">A</td><td style="text-align: left">Booked invoice</td><td style="text-align: left">General ledger</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">Book the paid invoice</td><td style="text-align: left">R</td><td style="text-align: left">A</td><td style="text-align: left">Paid invoice</td><td style="text-align: left">Bank records, General ledger</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">6</td><td style="text-align: left">Archive the paid invoice</td><td style="text-align: left">R</td><td style="text-align: left">I</td><td style="text-align: left">Archived invoice</td><td style="text-align: left">Accounts Receivable paid</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">7</td><td style="text-align: left">Check unpaid invoices</td><td style="text-align: left"></td><td style="text-align: left">R</td><td style="text-align: left">List of unpaid invoices to contact customer</td><td style="text-align: left">Note in CRM system</td><td style="text-align: left"></td></tr></table><p>Let&#39;s see how we can automate the procedure with Julia. We tackle it with a technique of Domain-Driven Design and the Onion architecture.</p><h2 id="A-review-of-the-procedure-Invoicing-1"><a class="docs-heading-anchor" href="#A-review-of-the-procedure-Invoicing-1">A review of the procedure Invoicing</a><a class="docs-heading-anchor-permalink" href="#A-review-of-the-procedure-Invoicing-1" title="Permalink"></a></h2><p>Looking at the <code>Invoicing</code> procedure, I see one domain or department, namely <code>Account Receivable.</code> It receives information from the process <code>Training Delivery,</code> which produces the list of students who have shown up in the classroom.</p><p>The resources are:</p><ul><li>Order file.</li><li>CSV list of bank records.</li><li>General Ledger.</li></ul><p>Owner of:</p><ul><li>Invoice</li></ul><p>Output</p><ul><li>Email with attached invoice as PDF</li><li>Journal record unpaid invoices for General Ledger.</li><li>Journal records paid invoices for General Ledger.</li><li>Report of unpaid invoices.</li><li>Invoice as PDF.</li></ul><h3 id="Summarized-1"><a class="docs-heading-anchor" href="#Summarized-1">Summarized</a><a class="docs-heading-anchor-permalink" href="#Summarized-1" title="Permalink"></a></h3><p>We send the invoice to the customer by email. We store a copy of the invoice locally. We sent the journalized copy to General Ledger. We need for testing:</p><ul><li>Dummy Order file module.</li><li>Dummy Training Delivery module.</li><li>Dummy General Ledger module.</li><li>Bank records file.</li></ul><h2 id="The-design-1"><a class="docs-heading-anchor" href="#The-design-1">The design</a><a class="docs-heading-anchor-permalink" href="#The-design-1" title="Permalink"></a></h2><h3 id="Domain-1"><a class="docs-heading-anchor" href="#Domain-1">Domain</a><a class="docs-heading-anchor-permalink" href="#Domain-1" title="Permalink"></a></h3><p>The domain objects are:</p><ul><li>Invoice.</li><li>InvoiceStatus: UNPAID, PAID, CREDITED.</li><li>JournalRecord.</li></ul><h3 id="API-Invoicing-1"><a class="docs-heading-anchor" href="#API-Invoicing-1">API Invoicing</a><a class="docs-heading-anchor-permalink" href="#API-Invoicing-1" title="Permalink"></a></h3><p>The API contains the methods (functions) of the module. The methods use only elements from the core or of the domain. An overview of what I think we need:</p><ul><li>create_invoice(id::String, company::Company, order::Order, students::Array(String, 1))::Invoice</li><li>create_pdf(invoice::Invoice)::PDF</li><li>send_invoice(invoice::Invoice, pdf::PDF)</li><li>update<em>invoice</em>status(invoice::Invoice; status=&quot;PAID&quot;)::Invoice</li><li>create<em>journal</em>record(invoice::Invoice)::JournalRecord</li><li>read_csv(file::String)::DataFrame</li><li>find_invoice(df::DataFrame)::Invoice</li><li>report<em>unpaid</em>invoices(db::SQLiteDB, table::String)::Dataframe</li></ul><p><a href="SQLite, tableName">DataFrames.jl</a>,  makes it easy to work with data.</p><h3 id="Infrastructure-1"><a class="docs-heading-anchor" href="#Infrastructure-1">Infrastructure</a><a class="docs-heading-anchor-permalink" href="#Infrastructure-1" title="Permalink"></a></h3><p>The methods of Infrastructure layer:</p><ul><li>connect(path::String)::SQLiteDB</li><li>save(db::SQLiteDB, tablename::String, invoice::Invoice)</li><li>read(db::SQLiteDB, tableName::String, selection::String)::DataFrame</li><li>create_pdf(invoice::Invoice)::PDF</li><li>send_invoice(invoice::Invoice, pdf::PDF)</li></ul><p><a href="https://juliadatabases.github.io/SQLite.jl/stable/">SQLite.jl</a> is the Julia package for SQLite, which we will use in the course. You can use it as an on-disk database file, but also as an in-memory database. The last option is ideal for testing.</p><h2 id="Application-infrastructure-1"><a class="docs-heading-anchor" href="#Application-infrastructure-1">Application infrastructure</a><a class="docs-heading-anchor-permalink" href="#Application-infrastructure-1" title="Permalink"></a></h2><pre><code class="language-none">                               +-----------+
                               | 1. Master |
                               +-----------+
                                     ↓ remotecall_fetch
                           _________     ________
                           ↓                    ↓
                   +--------------+     +--------------------+
                   | 2. Invoicing |     | 3. General Ledger  |
                   +--------------+     +--------------------+


Sequence diagram

     Master                  Invoicing                  General Ledger
       |
       |  addprocs
       |-------------------------&gt;|
       |                          |↷ load Invoice module
       |  remotecall_fetch(list)  |
       |-------------------------&gt;|
       |                          |↷ create_invoice
       |                          |
       |                          |↷ create_pdf
       |                          |
       |                          |↷ send_invoice
       |                          |
       |                          |↷ create_journal_record
       |                          |
       |                          |↷ connect
       |                          |
       |                          |↷ save(Db, JournalRecord)
       |  JournalRecord           |
       |&lt;-------------------------|
       |
       |  addprocs
       |-------------------------------------------------------&gt;|
       |  remotecall_fetch(JournalRecord)                       |
       |-------------------------------------------------------&gt;|
       |                                                        |</code></pre><ol><li>Master - Controlled-process in Docker container on the laptop.</li><li>Worker Invoicing - Controlled-process runs in a container on the laptop, created from Master.</li><li>Worker General Ledger - Controlled-process runs in a core on the laptop, created from Master.</li></ol><h2 id="ToDo-1"><a class="docs-heading-anchor" href="#ToDo-1">ToDo</a><a class="docs-heading-anchor-permalink" href="#ToDo-1" title="Permalink"></a></h2><ul><li>Thinking of Literate.jl as package to make PDFs.</li><li>How to attach a PDF to an email?</li><li>How to send an email?</li><li><a href="https://github.com/aviks/SMTPClient.jl">SMTPClient.jl</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../chapter2/">« 2 - Overview Julia</a><a class="docs-footer-nextpage" href="../chapter4/">4 - Implementing the design »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 19 December 2019 17:22">Thursday 19 December 2019</span>. Using Julia version 1.1.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
