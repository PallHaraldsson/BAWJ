<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>3 - The design · BAWJ</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="BAWJ logo"/></a><div class="docs-package-name"><span class="docs-autofit">BAWJ</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Business Applications with Julia</a></li><li><span class="tocitem">Section 1</span><ul><li><a class="tocitem" href="../chapter1/">1 - Intro Notebook</a></li><li><a class="tocitem" href="../chapter2/">2 - Overview Julia</a></li></ul></li><li><span class="tocitem">Section 2 - Building the application</span><ul><li class="is-active"><a class="tocitem" href>3 - The design</a><ul class="internal"><li><a class="tocitem" href="#Terms-and-definitions-1"><span>Terms and definitions</span></a></li><li><a class="tocitem" href="#A-procedure-as-a-starting-point-1"><span>A procedure as a starting point</span></a></li><li><a class="tocitem" href="#The-procedure-as-activity-diagram-1"><span>The procedure as activity diagram</span></a></li><li><a class="tocitem" href="#The-design-2"><span>The design</span></a></li><li><a class="tocitem" href="#Application-infrastructure-1"><span>Application infrastructure</span></a></li><li><a class="tocitem" href="#ToDo-1"><span>ToDo</span></a></li></ul></li><li><a class="tocitem" href="../chapter4/">4 - Implementing the design</a></li><li><a class="tocitem" href="../chapter5/">5 - Writing test software</a></li></ul></li><li><span class="tocitem">Section 3 - Modules</span><ul><li><a class="tocitem" href="../chapter6/">6 - Creating modules</a></li><li><a class="tocitem" href="../chapter7/">7 - Documenting the modules</a></li></ul></li><li><span class="tocitem">Section 4 - SSH enabled containers</span><ul><li><a class="tocitem" href="../chapter8/">8 - Introduction</a></li><li><a class="tocitem" href="../chapter9/">9 - Create SSH enabled Containers</a></li><li><a class="tocitem" href="../chapter10/">10 - Raspberry Pi</a></li></ul></li><li><span class="tocitem">Section 5 Up and running</span><ul><li><a class="tocitem" href="../chapter11/">11 - Running functions remote</a></li><li><a class="tocitem" href="../chapter12/">12 - Running the containers</a></li><li><a class="tocitem" href="../chapter13/">13 - Logging</a></li><li><a class="tocitem" href="../chapter20/">20 - Using Remote Channels (old stuff)</a></li></ul></li><li><a class="tocitem" href="../appendix/">Appendix</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Section 2 - Building the application</a></li><li class="is-active"><a href>3 - The design</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>3 - The design</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/rbontekoe/BAWJ/blob/master/docs/src/chapter3.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-design-1"><a class="docs-heading-anchor" href="#The-design-1">3 - The design</a><a class="docs-heading-anchor-permalink" href="#The-design-1" title="Permalink"></a></h1><h3 id="What-you-will-learn-1"><a class="docs-heading-anchor" href="#What-you-will-learn-1">What you will learn</a><a class="docs-heading-anchor-permalink" href="#What-you-will-learn-1" title="Permalink"></a></h3><ul><li><a href="#The-design-1">3 - The design</a></li><ul><li><a href="#Terms-and-definitions-1">Terms and definitions</a></li><li><a href="#A-procedure-as-a-starting-point-1">A procedure as a starting point</a></li><li><a href="#The-procedure-as-activity-diagram-1">The procedure as activity diagram</a></li><li><a href="#The-design-2">The design</a></li><li><a href="#Application-infrastructure-1">Application infrastructure</a></li><li><a href="#ToDo-1">ToDo</a></li></ul></ul><p>First, let&#39;s look at some terms and definitions. We&#39;ll convert the procedure <code>Invoicing</code> to a activity diagram. Using the Onion Architecture pattern, we define the <code>Domain</code> objects, and the Julia API-functions. In the <code>Infrastructure</code> layer we put the functions that interact with the outer world and the inner layers.</p><hr/><h2 id="Terms-and-definitions-1"><a class="docs-heading-anchor" href="#Terms-and-definitions-1">Terms and definitions</a><a class="docs-heading-anchor-permalink" href="#Terms-and-definitions-1" title="Permalink"></a></h2><p>The points of attention are:</p><ul><li>Procedure,</li><li>Domain-driven design,</li><li>Distributed processing, and</li><li>Style conventions.</li></ul><h3 id="Procedure-1"><a class="docs-heading-anchor" href="#Procedure-1">Procedure</a><a class="docs-heading-anchor-permalink" href="#Procedure-1" title="Permalink"></a></h3><p>A procedure is a description of work practice, a workflow. It describes a series of activities or actions in a particular order and interacts with people and machines. Actions make use of resources. Data, a service or a product, is the output of work.</p><h3 id="Domain-driven-design-1"><a class="docs-heading-anchor" href="#Domain-driven-design-1">Domain-driven design</a><a class="docs-heading-anchor-permalink" href="#Domain-driven-design-1" title="Permalink"></a></h3><p>Each process should be domain-specific. Subject matter experts and users of the domain speak the same language and use the same definitions and synonyms for concepts and objects. It leads to a Domain-driven design paradigm.</p><p>The Onion Architecture lends itself perfectly to the domain-driven design pattern. It divides an application into four areas: core, domain, API, and infrastructure.</p><p>The core consists out of the Julia language constructs and Julia modules. <a href="https://docs.julialang.org/en/v1/manual/modules/index.html">Modules</a> are also called packages.</p><p>The next layer, the domain, defines the domain entities and concepts. Between its elements, there must be coherence. You only use constructs from the <code>core.</code> <code>UnpaidInvoice</code> is an example.</p><p>The next peel is the API. The API consists of Julia functions that operate on the domain elements, and are used to create programs. You only use constructs from the <code>core and the domain.</code></p><p><code>create_unpaidinvoice,</code> <code>create_paidinvoice,</code> <code>create_pdf</code> are examples.</p><p>The infrastructure layer is the ultimate peel. With its functions, it communicates with the external world. Adapters overcome mismatches between interfaces. When you write you the code, you use <code>elements from the inner layers.</code></p><h3 id="Distributed-processing-1"><a class="docs-heading-anchor" href="#Distributed-processing-1">Distributed processing</a><a class="docs-heading-anchor-permalink" href="#Distributed-processing-1" title="Permalink"></a></h3><p>Programs, written in Julia language, also can run on other processor cores. Even in Docker containers on remote machines. Julia uses the master-worker concept. It means that the master executes Julia&#39;s functions on workers.</p><h3 id="Style-conventions-1"><a class="docs-heading-anchor" href="#Style-conventions-1">Style conventions</a><a class="docs-heading-anchor-permalink" href="#Style-conventions-1" title="Permalink"></a></h3><p>The article <a href="https://github.com/invenia/BlueStyle">Blue: a Style Guide for Julia</a> describes the style conventions.</p><hr/><h2 id="A-procedure-as-a-starting-point-1"><a class="docs-heading-anchor" href="#A-procedure-as-a-starting-point-1">A procedure as a starting point</a><a class="docs-heading-anchor-permalink" href="#A-procedure-as-a-starting-point-1" title="Permalink"></a></h2><p>In 1994 we were delivering Lotus Notes instructor-led training in the Netherlands. We became ISO-9001 certified one year later. ISO is short for the International Organization for Standardization. A part of ISO is the section procedures.</p><p>A procedure describes a workflow or business process. It specifies the activities to be carried out by people or machines and the resources that are required to produce a result.</p><p>An input triggers a process. Every action creates an output, most of the time, modified information or side-effects such as saving data.</p><p>The example I use in the course is the procedure <code>Invoicing.</code></p><h3 id="The-course-example-1"><a class="docs-heading-anchor" href="#The-course-example-1">The course example</a><a class="docs-heading-anchor-permalink" href="#The-course-example-1" title="Permalink"></a></h3><p>In 1998 we rewrote our procedures as a table. Every row represents an activity or action. Next to the events are the columns with the roles involved with the work. The original procedure:</p><p><strong>Procecdure</strong>: Invoicing.</p><p><strong>Roles</strong>: OM = Office Manage, AOM = Assistant Office Manager.</p><p><strong>Input</strong>: List of orders.</p><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">AOM</th><th style="text-align: left">OM</th><th style="text-align: left">Output</th><th style="text-align: left">Tool</th><th style="text-align: left">Exception</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">Create an invoice per order</td><td style="text-align: left">R</td><td style="text-align: left">A</td><td style="text-align: left">Created and authorized invoices</td><td style="text-align: left">Order file</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">Archive a copy of the invoice</td><td style="text-align: left">R</td><td style="text-align: left"></td><td style="text-align: left">Archived copy</td><td style="text-align: left">Accounts Receivable unpaid</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">Send the invoice to the customer</td><td style="text-align: left">R</td><td style="text-align: left">I</td><td style="text-align: left">Invoice sent</td><td style="text-align: left"></td><td style="text-align: left"></td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">Book the invoice</td><td style="text-align: left">R</td><td style="text-align: left">A</td><td style="text-align: left">Booked invoice</td><td style="text-align: left">General ledger</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">Book the paid invoice</td><td style="text-align: left">R</td><td style="text-align: left">A</td><td style="text-align: left">Paid invoice</td><td style="text-align: left">Bank records, General ledger</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">6</td><td style="text-align: left">Archive the paid invoice</td><td style="text-align: left">R</td><td style="text-align: left">I</td><td style="text-align: left">Archived invoice</td><td style="text-align: left">Accounts Receivable paid</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">7</td><td style="text-align: left">Check unpaid invoices</td><td style="text-align: left"></td><td style="text-align: left">R</td><td style="text-align: left">List of unpaid invoices to contact customer</td><td style="text-align: left">Note in CRM system</td><td style="text-align: left"></td></tr></table><p><strong>RASCI</strong></p><ul><li>R = Responsible, the entity who is responsible for the execution of the activity.</li><li>A = Approves, the entity who approves the result before going to the next step.</li><li>S = Supports, the members of the team.</li><li>C = Consults, the entity to be consulted.</li><li>I = Informed, the entity to be notified about the result.</li></ul><p>Let&#39;s see how we can automate the procedure with Julia. We tackle it with a technique of Domain-Driven Design and the Onion architecture.</p><hr/><h2 id="The-procedure-as-activity-diagram-1"><a class="docs-heading-anchor" href="#The-procedure-as-activity-diagram-1">The procedure as activity diagram</a><a class="docs-heading-anchor-permalink" href="#The-procedure-as-activity-diagram-1" title="Permalink"></a></h2><p>The activity diagram represents the API-layer. The actions are written down as Julia functions. Arguments and return value can be typed in Julia, noted by a double colon (::) followed by a name. This defines the domain entities, e.g., <code>::OpenCourseOrder, ::UnpaidInvoice</code>.</p><p>Forking and joining is represented by equal sign bars (======). Here we can determine which tasks can run in parallel.</p><pre><code class="language-none">    ○ List(::OpenCourseOrder)
    ↓
  create(::OpenCourseOrder)::UnpaidInvoice
    ↓
    ===========================
    ↓                         ↓
    archive(::UnpaidInvoice)  create(::UnpaidInvoice)::PDF  
    ↓                         ↓
    ===========================
    ↓
    send_email(::UnpaidInvoice, ::PDF)
    ↓
    post(::UnpaidInvoice)::JournalStatement # to General Ledger
    ↓
↻   ⋄ last Order?
    ↓ yes
    ◉


    ○ List(::BankStatement)
    ↓
  find(::BankStatement)::UnpaidInvoice
    ↓
    ⋄ UnpaidInvoice found?
↻   ↓ yes
    create(::UnpaidInvoice, ::Bankstatement)::PaidInvoice
    ↓
    ===========
    ↓         ↓
    archive   post_journalstm(::PaidInvoice)::JournalStatement
    ↓         ↓   
    ===========
    ↓
↻   ⋄ last BankStatement ?
    ↓ yes
    build_report_unpaid_invoices, when payment term is overdue.
    ↓
    send_report
    ↓
    ◉  </code></pre><h2 id="The-design-2"><a class="docs-heading-anchor" href="#The-design-2">The design</a><a class="docs-heading-anchor-permalink" href="#The-design-2" title="Permalink"></a></h2><p>From the activity diagram we get:</p><h3 id="Domain-1"><a class="docs-heading-anchor" href="#Domain-1">Domain</a><a class="docs-heading-anchor-permalink" href="#Domain-1" title="Permalink"></a></h3><p>The domain objects (types) are:</p><p>Domain Types:</p><ul><li>Invoice¹.</li><li>UnpaidInvoice &lt;: Invoice.</li><li>PaidInvoice &lt;: Invoice.</li></ul><p>External types</p><ul><li>Sales.OpenCourseOrder².</li><li>GeneralLedger.BankStatement³.</li><li>GeneralLedger.JournalStatement³.</li><li>GeneralLedger.JournalStatement³.</li></ul><p>General Types:</p><ul><li>DataFrame⁴</li></ul><p>¹ Abstract Type.</p><p>² Defined in the module Sales. We iterate on a list of orders that we will create in the test code to simplify the course.</p><p>³ Defined in the module GeneralLedger.</p><p>⁴ In the module DataFrames, delivered with Julia.</p><h3 id="API-Invoicing-1"><a class="docs-heading-anchor" href="#API-Invoicing-1">API Invoicing</a><a class="docs-heading-anchor-permalink" href="#API-Invoicing-1" title="Permalink"></a></h3><p>The API contains the methods (functions) of the module. The methods use only elements from the core or domain. An overview of we need:</p><ul><li>create(order::Order)::UnpaidInvoice</li><li>create(::UnpaidInvoice)::PaidInvoice</li><li>create(::Invoice)::JournalStatement</li></ul><p>We define and create the <code>Order, with the Training, Company, Contact, and Student</code> objects in the test code to simplify the course.</p><p><a href="SQLite, tableName">DataFrames.jl</a>,  makes it easy to work with data.</p><h3 id="Methods-of-Infrastructure-layer:-1"><a class="docs-heading-anchor" href="#Methods-of-Infrastructure-layer:-1">Methods of Infrastructure layer:</a><a class="docs-heading-anchor-permalink" href="#Methods-of-Infrastructure-layer:-1" title="Permalink"></a></h3><p>Database:</p><ul><li>connect(path::String)::SQLite.DB</li><li>save(db::SQLite.DB, tablename::String, invoice::Array{Invoice, 1})</li><li>read(db::SQLite.DB, tablename::String, selection::String)::DataFrame</li></ul><p>DBAdapter:</p><ul><li>archive(invoice::Invoice, save(db::SQLite.DB, tablename::String, invoice::Invoice))</li><li>find(Invoice.id, read(db::SQLite.DB, tablename::String, &quot;item=&#39;Invoice.id&#39;&quot;))::DataFrame</li></ul><p>Email:</p><ul><li>to_pdf(invoice::Invoice, filename::String)::File</li><li>send(invoice::Invoice, filename::String)</li><li>send(report::DataFrame)</li></ul><p><a href="https://juliadatabases.github.io/SQLite.jl/stable/">SQLite.jl</a> is the Julia package for SQLite, which we will use in the course. You can use it as an on-disk database file, but also as an in-memory database. The last option is ideal for testing.</p><h2 id="Application-infrastructure-1"><a class="docs-heading-anchor" href="#Application-infrastructure-1">Application infrastructure</a><a class="docs-heading-anchor-permalink" href="#Application-infrastructure-1" title="Permalink"></a></h2><pre><code class="language-none">                               +-----------+
                               | 1. Master |
                               +-----------+
                                     ↓
                                     ◊
   OpenCourseOrder / BankStatement  ↙ ↘  JournalStatement
                   +--------------+     +--------------------+
                   | 2. Invoicing |     | 3. General Ledger  |   Workers
                   +--------------+     +--------------------+
                          ↓
                   JournalStatement</code></pre><ol><li>Master - Runs in a container.</li><li>Worker Invoicing - Function, see <a href="#Activity-diagram-1">Activity diagram</a>, runs in a container.</li><li>Worker General Ledger - Dummy, runs on a core.</li></ol><h2 id="ToDo-1"><a class="docs-heading-anchor" href="#ToDo-1">ToDo</a><a class="docs-heading-anchor-permalink" href="#ToDo-1" title="Permalink"></a></h2><ul><li>Thinking of Literate.jl as package to make PDFs.</li><li>How to attach a PDF to an email?</li><li>How to send an email?</li><li><a href="https://github.com/aviks/SMTPClient.jl">SMTPClient.jl</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../chapter2/">« 2 - Overview Julia</a><a class="docs-footer-nextpage" href="../chapter4/">4 - Implementing the design »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 25 December 2019 15:38">Wednesday 25 December 2019</span>. Using Julia version 1.1.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
