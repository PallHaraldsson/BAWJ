<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>9 - Ubuntu 18.04 · BAWJ</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../"><img class="logo" src="../assets/logo.png" alt="BAWJ logo"/></a><h1>BAWJ</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Business Applications with Julia</a></li><li><span class="toctext">Section 1</span><ul><li><a class="toctext" href="../chapter1/">1 - Intro Notebook</a></li><li><a class="toctext" href="../chapter2/">2 - Overview Julia</a></li></ul></li><li><span class="toctext">Section 2 - Building the application</span><ul><li><a class="toctext" href="../chapter3/">3 - Set-up the design</a></li><li><a class="toctext" href="../chapter4/">4 - Implementing the design</a></li><li><a class="toctext" href="../chapter5/">5 - Writing test software</a></li></ul></li><li><span class="toctext">Section 3 - Modules</span><ul><li><a class="toctext" href="../chapter6/">6 - Creating modules</a></li><li><a class="toctext" href="../chapter7/">7 - Documenting the modules</a></li></ul></li><li><span class="toctext">Section 4 - SSH enabled containers</span><ul><li><a class="toctext" href="../chapter8/">8 - Introduction</a></li><li class="current"><a class="toctext" href>9 - Ubuntu 18.04</a><ul class="internal"><li><a class="toctext" href="#Index-1">Index</a></li><li><a class="toctext" href="#Activity-1-Create-a-SSH-enabled-container-1">Activity 1 - Create a SSH enabled container</a></li><li><a class="toctext" href="#The-Dockerfile-1">The Dockerfile</a></li><li><a class="toctext" href="#Activity-2-Install-Julia-in-the-container-1">Activity 2 - Install Julia in the container</a></li><li><a class="toctext" href="#Test-the-SSH-enabled-container.-1">Test the SSH enabled container.</a></li></ul></li><li><a class="toctext" href="../chapter10/">10 - Raspberry Pi</a></li></ul></li><li><span class="toctext">Section 5 Up and running</span><ul><li><a class="toctext" href="../chapter11/">11 - Conatiner-container communication</a></li><li><a class="toctext" href="../chapter12/">12 - Running the containers</a></li></ul></li><li><a class="toctext" href="../appendix/">Appendix</a></li><li><a class="toctext" href="../references/">References</a></li></ul></nav><article id="docs"><header><nav><ul><li>Section 4 - SSH enabled containers</li><li><a href>9 - Ubuntu 18.04</a></li></ul><a class="edit-page" href="https://github.com/rbontekoe/BAWJ/blob/master/docs/src/chapter9.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>9 - Ubuntu 18.04</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Ubuntu-18.04-1" href="#Ubuntu-18.04-1">Ubuntu 18.04</a></h1><h2><a class="nav-anchor" id="Index-1" href="#Index-1">Index</a></h2><ul><li><a href="#Ubuntu-18.04-1">Ubuntu 18.04</a></li><ul><li><a href="#Index-1">Index</a></li><li><a href="#Activity-1-Create-a-SSH-enabled-container-1">Activity 1 - Create a SSH enabled container</a></li><li><a href="#The-Dockerfile-1">The Dockerfile</a></li><li><a href="#Activity-2-Install-Julia-in-the-container-1">Activity 2 - Install Julia in the container</a></li><li><a href="#Test-the-SSH-enabled-container.-1">Test the SSH enabled container.</a></li></ul></ul><p>The article <a href="https://docs.docker.com/engine/examples/running_ssh_service/">Dockerize an SSH service</a> uses Ubuntu 16.04 as the base image. However, Julia 1.0 and higher needs Ubuntu 18.04, so we have changed the Dockerfile. This version of Ubuntu also requires that you create a user with administrator rights when you use SSH to connect.</p><p>You also learn to install Julia in the container.</p><p>To make use of passwordless connections between containers, you also learn to create certificates.</p><p>In the next chapter, we will show you how to create containers on a Raspberry Pi 3B. I have another project running where I communicate with a Raspberry Pi to transfer images to my laptop.</p><p>See also the Pact book Julia 1.0 Programming: <a href="https://subscription.packtpub.com/book/application_development/9781788998369/1/ch01lvl1sec12/installing-julia-from-binaries">Installing Julia from binaries</a></p><h2><a class="nav-anchor" id="Activity-1-Create-a-SSH-enabled-container-1" href="#Activity-1-Create-a-SSH-enabled-container-1">Activity 1 - Create a SSH enabled container</a></h2><p>Prerequisites:</p><ul><li>Your system has Ubuntu 18.04 that runs on an Intel x86 processor.</li><li>You have started your computer.</li></ul><p>Steps:</p><ol><li>Create a Dockerfile in the folder test_sshd.</li><li>Create a Docker image eg_ssdh and the container test_sshd.</li><li>Create a user <code>rob</code>, who has administrator rights.</li></ol><h2><a class="nav-anchor" id="The-Dockerfile-1" href="#The-Dockerfile-1">The Dockerfile</a></h2><pre><code class="language-none">FROM ubuntu:18.04

RUN apt-get update &amp;&amp; apt-get install -y openssh-server
RUN mkdir /var/run/sshd
RUN sed -i &#39;s/PermitRootLogin prohibit-password/PermitRootLogin yes/&#39; /etc/ssh/sshd_config

# SSH login fix. Otherwise user is kicked off after login
RUN sed &#39;s@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g&#39; -i /etc/pam.d/sshd

ENV NOTVISIBLE &quot;in users profile&quot;
RUN echo &quot;export VISIBLE=now&quot; &gt;&gt; /etc/profile

EXPOSE 22
CMD [&quot;/usr/sbin/sshd&quot;, &quot;-D&quot;]</code></pre><h3><a class="nav-anchor" id=".-Create-a-Dockerfile-in-the-folder-test_sshd-1" href="#.-Create-a-Dockerfile-in-the-folder-test_sshd-1">1. Create a Dockerfile in the folder test_sshd</a></h3><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">2</td><td style="text-align: left">$ mkdir test-ssh</td><td style="text-align: left">Create a new folder.</td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">$ cd test-ssh</td><td style="text-align: left">Go to the folder.</td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">Select the content of the Dockerfile <a href="#Dockerfile-1">above</a></td><td style="text-align: left"></td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">Ctrl-C</td><td style="text-align: left">Copy the selected text to the clipboard.</td></tr><tr><td style="text-align: left">6</td><td style="text-align: left">$ nano Dockerfile</td><td style="text-align: left">Create a new empty file.</td></tr><tr><td style="text-align: left">7</td><td style="text-align: left">Shift-Ctrl-V</td><td style="text-align: left">Paste text from the clipboard into nano.</td></tr><tr><td style="text-align: left">8</td><td style="text-align: left">Ctrl-O</td><td style="text-align: left">Save the file.</td></tr><tr><td style="text-align: left">9</td><td style="text-align: left">Ctrl-X</td><td style="text-align: left">Exit nano.</td></tr></table><h3><a class="nav-anchor" id=".-Create-a-Docker-image-eg*ssdh-and-the-container-test*sshd-1" href="#.-Create-a-Docker-image-eg*ssdh-and-the-container-test*sshd-1">2. Create a Docker image eg<em>ssdh and the container test</em>sshd</a></h3><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">$ sudo docker build -t eg_sshd .</td><td style="text-align: left">Create a Docker image from the Dockerfile</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">$ sudo docker run -d -P --name test_sshd eg_sshd</td><td style="text-align: left">Create a container</td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">$ sudo docker port test_sshd 22</td><td style="text-align: left">Find port number</td></tr><tr><td style="text-align: left"></td><td style="text-align: left">0.0.0.0:32768</td><td style="text-align: left">Response</td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">$ sudo docker ps</td><td style="text-align: left">Check whether the container is running.</td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">$ sudo docker exec -it test_sshd bash</td><td style="text-align: left">Enter the container</td></tr><tr><td style="text-align: left">6</td><td style="text-align: left">Ctrl-D</td><td style="text-align: left">Leave the container.</td></tr></table><h3><a class="nav-anchor" id=".-Create-a-user-rob,-who-has-administrator-rights-1" href="#.-Create-a-user-rob,-who-has-administrator-rights-1">3. Create a user <code>rob</code>, who has administrator rights</a></h3><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">$ sudo docker exec -it test_sshd bash</td><td style="text-align: left">Enter the container</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">$ adduser rob</td><td style="text-align: left"></td></tr></table><p>You are asked to give the user rob a password. We will use the password in the future for the SSH connection to the container, so write it down. You need it the first time when you want to enable passwordless communication. From Ubuntu 18.04 on, you don&#39;t know the roots&#39; password anymore. That is the reason we had to create a user with administrator rights for SSH connections.</p><p>Step | Action | Comment | | 3 | $ usermod -aG sudo rob | Give user adminsistrator rights. | | 4 | $ su rob | Switch to the user rob | | 5 | # sudo -i | Back as root user | | 6 | Ctrl-D | Leave the container. |</p><h2><a class="nav-anchor" id="Activity-2-Install-Julia-in-the-container-1" href="#Activity-2-Install-Julia-in-the-container-1">Activity 2 - Install Julia in the container</a></h2><p>Prerequisites:</p><ul><li>Your system has Ubuntu 18.04 running on the Intel x86 processor.</li><li>The container test_sshd exists.</li><li>The container has the user <code>rob</code>, who has administrators (sudo) rights.</li></ul><p>Activity:</p><ol><li>Download the Julia binary and copy it to the container.</li><li>Install Julia and test the installation.</li><li>Create a symbolic link to start Julia from everywhere.</li></ol><h3><a class="nav-anchor" id=".-Download-the-Julia-binary-and-copy-it-to-the-container-1" href="#.-Download-the-Julia-binary-and-copy-it-to-the-container-1">1. Download the Julia binary and copy it to the container</a></h3><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left"><a href="https://julialang.org/downloads/">Download Julia</a></td><td style="text-align: left">eg. julia-1.3.0-linux-x86_64.tar.gz</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">$ docker ps -a</td><td style="text-align: left">Check whether container test_ssh exists.</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">$ docker start test_sshd</td><td style="text-align: left">Start the container.</td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">$ docker cp julia-1.3.0-linux-x86<em>64.tar.gz test</em>sshd:/home/rob</td><td style="text-align: left">Copy the downloaded file to the container.</td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">~$ docker exec -it test_sshd bash</td><td style="text-align: left">Enter the conatiner.</td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">$ su rob</td><td style="text-align: left">Switch to user rob.</td></tr></table><h3><a class="nav-anchor" id=".-Install-Julia-and-test-the-installation-1" href="#.-Install-Julia-and-test-the-installation-1">2. Install Julia and test the installation</a></h3><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">5</td><td style="text-align: left"># mkdir julia</td><td style="text-align: left">Create folder julia.</td></tr><tr><td style="text-align: left">6</td><td style="text-align: left"># mv julia-1.3.0-linux-x86_64.tar.gz julia</td><td style="text-align: left">Move file to folder.</td></tr><tr><td style="text-align: left">7</td><td style="text-align: left"># cd julia</td><td style="text-align: left">Enter folder</td></tr><tr><td style="text-align: left">8</td><td style="text-align: left">/julia# tar -zxvf julia-1.3.0-linux-x86_64.tar.gz</td><td style="text-align: left">Extract the file</td></tr><tr><td style="text-align: left">9</td><td style="text-align: left">/julia# ls</td><td style="text-align: left">List the content of the folder.</td></tr><tr><td style="text-align: left"></td><td style="text-align: left">julia-1.3.0  julia-1.3.0-linux-x86_64.tar.gz</td><td style="text-align: left">Response</td></tr><tr><td style="text-align: left">10</td><td style="text-align: left">/julia# cd julia-1.3.0/bin/</td><td style="text-align: left">We will test Julia.</td></tr><tr><td style="text-align: left">11</td><td style="text-align: left">/julia/julia-1.3.0/bin#./julia</td><td style="text-align: left">Start Julia.</td></tr></table><p>The result (leave Julia with Ctrl-D).</p><pre><code class="language-_">   _       _ _(_)_     |  Documentation: https://docs.julialang.org
  (_)     | (_) (_)    |
   _ _   _| |_  __ _   |  Type &quot;?&quot; for help, &quot;]?&quot; for Pkg help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 1.3.0 (2019-11-26)
 _/ |\__&#39;_|_|_|\__&#39;_|  |  Official https://julialang.org/ release
|__/                   |

julia&gt;</code></pre><h3><a class="nav-anchor" id=".-Create-a-symbolic-link-to-start-Julia-from-everywhere-1" href="#.-Create-a-symbolic-link-to-start-Julia-from-everywhere-1">3. Create a symbolic link to start Julia from everywhere</a></h3><p>|| Step | Action | Comment | :–- | :–- | :–- |</p><h2><a class="nav-anchor" id="Test-the-SSH-enabled-container.-1" href="#Test-the-SSH-enabled-container.-1">Test the SSH enabled container.</a></h2><p>Prerequisites:</p><ul><li>You have an SSH enabled container.</li></ul><p>Steps:</p><ol><li>Create local SSH keys.</li><li>Copy your public key to the container.</li><li>Test the SSH connection with the container.</li></ol><h3><a class="nav-anchor" id=".-Create-local-SSH-keys-on-your-computer-1" href="#.-Create-local-SSH-keys-on-your-computer-1">1. Create local SSH keys on your computer</a></h3><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">$ sudo apt-get update</td><td style="text-align: left"></td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">$ sudo apt-get install openssh-client</td><td style="text-align: left">Install ssh client on Ubuntu.</td></tr><tr><td style="text-align: left">3</td><td style="text-align: left">$ ls -al ~/.ssh/id_*.pub</td><td style="text-align: left">View old keys.</td></tr><tr><td style="text-align: left">4</td><td style="text-align: left">$ ssh-keygen -t rsa -b 4096 -C &quot;your_email@domain.com&quot;</td><td style="text-align: left">Generate the key.</td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">$ ls ~/.ssh/id_*</td><td style="text-align: left">View your new keys.</td></tr></table><p>TODO: Lookup first what I did in the past! Want to use volumes in case container crashes, security, etc.</p><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">8</td><td style="text-align: left">$ chmod 700 ~/.ssh</td><td style="text-align: left">Change right the folder .ssh on Raspberry Pi</td></tr><tr><td style="text-align: left">9</td><td style="text-align: left">$ chmod 600 ~/.ssh/authorized_keys</td><td style="text-align: left">Change right of the file authorized_keys on Raspberry Pi</td></tr></table><h3><a class="nav-anchor" id=".-Copy-your-public-key-to-the-container-1" href="#.-Copy-your-public-key-to-the-container-1">2. Copy your public key to the container</a></h3><table><tr><th style="text-align: left">Step</th><th style="text-align: left">Action</th><th style="text-align: left">Comment</th></tr><tr><td style="text-align: left">1</td><td style="text-align: left">$ sudo docker ps</td><td style="text-align: left">Check whether the container is already running.</td></tr><tr><td style="text-align: left">2</td><td style="text-align: left">$ sudo docker start test_sshd</td><td style="text-align: left">Start the container if not running.</td></tr><tr><td style="text-align: left">5</td><td style="text-align: left">$ ssh-copy-id  rob@192.168.XXX.XXX</td><td style="text-align: left">Copy file to container</td></tr><tr><td style="text-align: left">6</td><td style="text-align: left">$</td><td style="text-align: left">Check port number of container, eg, 32769</td></tr><tr><td style="text-align: left">7</td><td style="text-align: left">$ ssh rob@localhost -p 32768</td><td style="text-align: left">Connect container.</td></tr></table><footer><hr/><a class="previous" href="../chapter8/"><span class="direction">Previous</span><span class="title">8 - Introduction</span></a><a class="next" href="../chapter10/"><span class="direction">Next</span><span class="title">10 - Raspberry Pi</span></a></footer></article></body></html>
